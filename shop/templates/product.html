{% extends 'base.html' %}
{% load tags %}
{% load social_share %}
{% load static %}

{% block title %}
    {{ product }}
{% endblock %}

{% block title_og %}
    {{ product }}
{% endblock %}

{% block page_keywords %}
    {{ product.name }}, {{ product.name_en }}, عطر, ادکلن, پرفیوم, فروشگاه نی عنبر, عطر طبیعی, عطر اسلامی, عطر دست‌ساز, {{ product.name }} اصل, خرید {{ product.name }},
{% endblock %}

{% block page_description %}
    {{ product }}
{% endblock %}

{% block content %}
    <input type="hidden" name="product-id" value="{{ product.id }}">
    <main class="main single-product rtl text-right">
        <div class="page-content">
            <div class="container">
                <nav class="breadcrumb-nav">
                    <div class="container breadcrumb-nav-wrap">
                        <ul class="breadcrumb ">
                            <li><a href="{% url 'main:index' %}"><i class="fa-light fa-house"></i></a></li>
                            <li><a href="{% url 'shop:product-list' %}">محصولات</a></li>
                            <li>{{ product }}</li>
                        </ul>
                    </div>
                </nav>
                <div class="row gutter-lg single-product-wrap">
                    <div class="col-xl-9 col-lg-8">
                        <div class="product product-single row mb-5">
                            <div class="col-md-6">
                                <div class="product-gallery">
                                    <div id="product-zoom" class="owl-carousel owl-theme owl-nav-inner row cols-1 gutter-no ltr">
                                        {% for image in product.images.all %}
                                            <figure class="product-image">
                                                <picture>
                                                    <source srcset="{{ image.image.url }}" type="image/webp">
                                                    <img loading="lazy" decoding="async" src="{{ image.image.url }}"
                                                         data-zoom-image="{{ image.image.url }}"
                                                         alt="{{ image.alt }}" width="800" height="900">
                                                </picture>
                                            </figure>
                                        {% endfor %}
                                    </div>
                                    <div class="product-thumbs-wrap ltr">
                                        <div class="product-thumbs">
                                            {% for image in product.images.all %}
                                                <div class="product-thumb {% if forloop.first %}active{% endif %}">
                                                    <picture>
                                                        <source srcset="{{ image.image.url }}" type="image/webp">
                                                        <img loading="lazy" decoding="async" src="{{ image.image.url }}"
                                                             alt="product thumbnail"
                                                             width="150" height="169">
                                                    </picture>
                                                </div>
                                            {% endfor %}
                                        </div>
                                        {#                                        <button class="thumb-up disabled"><i class="fa-light fa-chevron-right"></i></button>#}
                                        {#                                        <button class="thumb-down disabled"><i class="fa-light fa-chevron-left"></i></button>#}
                                    </div>
                                    <div class="product-label-group">
                                        {% if not product.inventory %}
                                            <div class="sold-out">تمام شد</div>
                                        {% else %}
                                            {% if product.discount != -1 %}
                                                <div class="discount">{{ product.get_price_difference }}% تخفیف</div>
                                            {% endif %}
                                            {% if product.created_at|is_new %}
                                                <div class="new-label">جدید</div>
                                            {% endif %}
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="product-details pt-3">
                                    <h1 class="product-name">{{ product }}</h1>
                                    <h3 class="product-name-en">{{ product.name_en }}</h3>
                                    <div class="product-meta">
                                        کد کالا :<span class="product-sku ml-3">{{ product.pid }}</span>
                                        امتیاز سایت :<span class="product-sku ml-3">{{ product.site_score }}/10</span>
                                        دسته بندی : <span
                                            class="product-brand">{{ product.get_perfume_type_display }}</span>
                                    </div>
                                    <div class="product-price" id="product-actual-price" data-price="{{ product.price }}" data-discount="{{ product.discount }}"> {{ product.get_price | commafy }} تومان</div>
                                    {% if product.discount != -1 and product.reset_discount_at %}
                                        <div class="product-countdown-container font-weight-semi-bold bg-secondary border-no mb-3">
                                            <label class="">تخفیف به پایان می رسد در: </label>
                                            <div class="product-countdown countdown-compact" data-until="{{ product.reset_discount_at | date:'c' }}" data-compact="true">00:00:00</div><!-- End of .product-countdown -->
                                        </div>
                                    {% endif %}
                                    <div class="ratings-container">
                                        <a href="#product-tab-reviews" class="link-to-tab rating-reviews">
                                            {% if product.inventory %}
                                                ({{ product.inventory }} عدد موجود در انبار)
                                            {% else %}
                                                موجود نیست
                                            {% endif %}
                                        </a>
                                    </div>
                                    <p class="product-short-desc">
                                        {{ product.short_description | safe }}
                                    </p>
                                    <div class="table-info">
                                        <table class="table table-bordered table-striped">
                                            <tbody>
                                            <tr>
                                                <td>
                                                    <span style="color: #000000;">سایز</span>
                                                </td>
                                                <td><span style="color: #000000;">{{ product.get_volumes }}</span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <span style="color: #000000;">طبع</span>
                                                </td>
                                                <td>
                                                    <span style="color: #000000;">{{ product.get_nature_display }}</span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <span style="color: #000000;">گروه بویایی</span>
                                                </td>
                                                <td>
                                                    <span style="color: #000000;">{{ product.get_smell }}</span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <span style="color: #000000;">فصل</span></td>
                                                <td>
                                                    <span style="color: #000000;">{{ product.get_season_display }}</span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <span style="color: #000000;">جنسیت</span>
                                                </td>
                                                <td>
                                                    <span style="color: #000000;">{{ product.get_gender_display }}</span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <span style="color: #000000;">نوع عطر</span>
                                                </td>
                                                <td>
                                                    <span style="color: #000000;">{{ product.get_perfume_type_display }}</span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <span style="color: #000000;">طعم</span>
                                                </td>
                                                <td>
                                                    <span style="color: #000000;">{{ product.get_taste_display }}</span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <span style="color: #000000;">ماندگاری</span>
                                                </td>
                                                <td>
                                                    <span style="color: #000000;">{{ product.get_durability_display }}</span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <span style="color: #000000;">پخش بو</span>
                                                </td>
                                                <td>
                                                    <span style="color: #000000;">{{ product.get_spread_display }}</span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <span style="color: #000000;">برند</span>
                                                </td>
                                                <td>
                                                    <span style="color: #000000;">{{ product.brand }}</span>
                                                </td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    {% if product.available_volumes %}
                                            <div class="product-form product-size">
                                                <label>حجم(به گرم):</label>
                                                <div class="product-form-group">
                                                    <div class="product-variations">
                                                        {% for volume in product.available_volumes.all %}
                                                            <a class="size" style="width: fit-content;direction: rtl" href="#" data-price="{{ volume.volume }}">{{ volume.name }}</a>
                                                        {% endfor %}
                                                    </div>
                                                    <a href="#" class="product-variation-clean">پاک کردن همه</a>
                                                </div>
                                            </div>
                                        <div class="product-variation-price">
                                            <span id="final-price">13,500,000 تومان </span>
                                        </div>
                                    {% endif %}
                                    <hr class="product-divider">
                                    <div class="product-form product-qty mb-3">
                                        <div class="product-form-group">
                                            {% if product.inventory %}
                                                <div class="input-group">
                                                    <button class="quantity-minus d-icon-minus"></button>
                                                    <input class="quantity form-control b-r-0 w-100 cart-quantity" type="number" min="1"
                                                           max="{{ product.inventory }}">
                                                    <button class="quantity-plus d-icon-plus"></button>
                                                </div>
                                                <button class="btn btn-primary btn-product text-normal ls-normal font-weight-semi-bold add-to-cart has-quantity" data-id="{{ product.id }}">
                                                   اضافه به سبد خرید<i class="fa-light fa-basket-shopping-simple"></i>
                                                </button>
                                            {% else %}
                                                <button class="btn btn-primary w-100 text-normal ls-normal font-weight-semi-bold {% if request.user.is_authenticated %}btn-notify-me{% else %}login-toggle{% endif %}">
                                                    {% if request.user in product.remind_to.all %}منتظر موجود شدن{% else %}در صورت موجود شدن اطلاع بده{% endif %}<i class="fa-light fa-message"></i>
                                                </button>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <hr class="product-divider mb-3">
                                    <div class="product-footer">
                                        <p>اشتراک گذاری:&nbsp;</p>
                                        <div class="social-links pl-4">
                                            {% post_to_whatsapp product 'واتساپ' %}
                                            &nbsp;|&nbsp;
                                            {% post_to_telegram '' product 'تلگرام' %}
                                        </div>
                                        <span class="divider"></span>
                                        <div class="product-action">
                                            <a href="#" class="ml-2 btn-add-wishlist">
                                                <i class="fa-light fa-heart-full like-icon" {% if request.user in product.liked_by.all %}style="color: red;"{% endif %}></i> علاقه ها
                                            </a>
                                            <a href="#" class="btn-compare-product">
                                                <i class="fa-light fa-scale-balanced"></i> {% if product in request.user.compare_list.all %}حذف از لیست مقایسه{% else %}مقایسه{% endif %}
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="service-wrapper">
                            <div class="owl-carousel owl-theme row cols-xxl-4 cols-xl-3 cols-lg-2 cols-md-3 cols-sm-2 cols-1"
                                 data-owl-options="{
                                     'rtl':true,
                                                'nav': false,
                                                'auto': false,
                                                'dots': false,
                                                'loop': true,
                                                'autoplay': true,
                                                'responsive': {
                                                    '0': {
                                                        'items': 1,
                                                        'autoplay': true
                                                    },
                                                    '576': {
                                                        'items': 2,
                                                        'autoplay': true
                                                    },
                                                    '768': {
                                                        'items': 3
                                                    },
                                                    '992': {
                                                        'items': 2
                                                    },
                                                    '1200': {
                                                        'items': 3
                                                    },
                                                    '1600': {
                                                        'items': 3
                                                    }
                                                }
                                            }">
                                <div class="icon-box icon-box-side icon-box1 icon-box-main">
                                    <i class="icon-box-icon fa-light fa-truck-fast"></i>
                                    <div class="icon-box-content">
                                        <h4 class="icon-box-title lh-1">
                                            حمل و نقل سریع و مرجوعی
                                        </h4>
                                        <p class="lh-1"> سراسر کشور</p>
                                    </div>
                                </div>
                                <div class="icon-box icon-box-side icon-box2 icon-box-main">
                                    <i class="icon-box-icon fa-light fa-timer"></i>
                                    <div class="icon-box-content">
                                        <h4 class="icon-box-title lh-1">
                                            پشتیبانی
                                        </h4>
                                        <p class="lh-1">شبانه روزی </p>
                                    </div>
                                </div>
                                <div class="icon-box icon-box-side icon-box3 icon-box-main">
                                    <i class="icon-box-icon fa-light fa-badge-check"></i>
                                    <div class="icon-box-content">
                                        <h4 class="icon-box-title lh-1">
                                            پرداخت 100% مطمئن
                                        </h4>
                                        <p class="lh-1"> در امنیت کامل</p>
                                    </div>
                                </div>
                                <div class="icon-box icon-box-side icon-box4 icon-box-main">
                                    <i class="icon-box-icon fa-light fa-tags"></i>
                                    <div class="icon-box-content">
                                        <h4 class="icon-box-title lh-1">
                                            گارانتی مرجوعی
                                        </h4>
                                        <p class="lh-1">تضمین 3 روزه مرجوعی</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab tab-nav-simple product-tabs">
                            <ul class="nav nav-tabs justify-content-center" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link active" href="#product-tab-description">توضیحات</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link comment-count" href="#product-tab-reviews">نظر ({{ product.comments.count }})</a>
                                </li>
                            </ul>
                            <div class="tab-content">
                                <div class="tab-pane active in" id="product-tab-description">
                                    <div class="row mt-6">
                                        <div class="col-12">
                                            {{ product.description | safe }}
                                        </div>
                                        {% if product.video %}
                                            <div class="col-12 mt-4">
                                                <h5 class="description-title font-weight-semi-bold ls-m mb-5">
                                                    ویدئو توضیحات
                                                </h5>
                                                <video
                                                        controls
                                                        preload="metadata"
                                                        poster="{{ product.images.first.image.url }}"
                                                        width="100%"
                                                        height="auto"
                                                        style="max-width: 559px; max-height: 370px;"
                                                >
                                                    <source src="{{ product.video.url }}" type="video/mp4">
                                                    مرورگر شما از تگ ویدئو پشتیبانی نمی‌کند.
                                                </video>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="tab-pane " id="product-tab-reviews">
                                    <div class="row">
                                        <div class="col-12 mb-6">
                                            <div class="avg-rating-container">
                                                <mark>{{ rating }}</mark>
                                                <div class="avg-rating">
                                                    <span class="avg-rating-title">میانگین امتیاز</span>
                                                    <div class="ratings-container mb-0">
                                                        <div class="ratings-full">
                                                            <span class="ratings" style="width:{% widthratio rating 1 20 %}%"></span>
                                                            <span class="tooltiptext tooltip-top"></span>
                                                        </div>
                                                        <span class="rating-reviews">(از {{ product.comments.count }} نظر)</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="ratings-list mb-2">
                                                <div class="ratings-item">
                                                    <div class="ratings-container mb-0">
                                                        <div class="ratings-full">
                                                            <span class="ratings" style="width:100%"></span>
                                                            <span class="tooltiptext tooltip-top"></span>
                                                        </div>
                                                    </div>
                                                    <div class="rating-percent">
                                                        <span style="width:60%;"></span>
                                                    </div>
                                                    <div class="progress-value">60%</div>
                                                </div>
                                            </div>
                                            <button class="tag rate" id="rate-1" data-rate="1">خیلی بد</button>
                                            <button class="tag rate" id="rate-2" data-rate="2">بد</button>
                                            <button class="tag rate" id="rate-3" data-rate="3" style="color: #05595B; border-color: #05595B;">متوسط</button>
                                            <button class="tag rate" id="rate-4" data-rate="4">خوب</button>
                                            <button class="tag rate" id="rate-5" data-rate="5">عالی</button>
                                            <hr>
                                            <textarea id="review-message" cols="15" rows="6" class="form-control mb-4"
                                                      placeholder="دیدگاه شما *"></textarea>
                                            {% if request.user.is_authenticated %}
                                                <a class="btn btn-dark btn-rounded submit-review-toggle" href="#">
                                                    ارسال
                                                    نظر
                                                </a>
                                            {% else %}
                                                <a class="btn btn-dark btn-rounded login-toggle" href="#">
                                                    ورود به حساب
                                                </a>
                                            {% endif %}
                                        </div>
                                        <div class="col-12 comments pt-2 pb-10 border-no">
                                            <ul class="comments-list">
                                                {% for comment in product.comments.all %}
                                                    <li>
                                                        <div class="comment">
                                                            <figure class="comment-media">
                                                                <a href="#">
                                                                    <picture>
                                                                        <source srcset="{{ comment.user.profile.url }}"
                                                                                type="image/webp">
                                                                        <img loading="lazy" decoding="async"
                                                                             src="{{ comment.user.profile.url }}" alt="avatar">
                                                                    </picture>
                                                                </a>
                                                            </figure>
                                                            <div class="comment-body">
                                                                <div class="comment-rating ratings-container">
                                                                    <div class="ratings-full">
                                                                        <span class="ratings" style="width:{% widthratio comment.score 1 20 %}%"></span>
                                                                        <span class="tooltiptext tooltip-top"></span>
                                                                    </div>
                                                                </div>
                                                                <div class="comment-user">
                                                                <span class="comment-date">
                                                                    نویسنده :   <span
                                                                        class="font-weight-semi-bold text-dark">
                                                                        {{ comment.user }}
                                                                    </span> در
                                                                    <span class="font-weight-semi-bold text-dark">
                                                                        {{ comment.created_at | to_jalali_verbose }}
                                                                    </span>
                                                                </span>
                                                                </div>
                                                                <div class="comment-content mb-5">
                                                                    <p>
                                                                        {{ comment.content }}
                                                                    </p>
                                                                </div>
                                                                <div class="feeling mt-5">
                                                                    <button class="btn btn-link btn-icon-left btn-slide-up btn-infinite ml-2 like-comment" data-id="{{ comment.id }}">
                                                                        <i class="fa fa-thumbs-up"></i>
                                                                        لایک (<span class="count">{{ comment.liked_by.count }}</span>)
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </li>
                                                {% endfor %}
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <section class="pt-2 mt-10">
                            <h2 class="title justify-content-center ls-normal">محصولات مرتبط</h2>
                            <div class="owl-carousel owl-theme owl-nav-full row cols-2 cols-md-3 cols-lg-4"
                                 data-owl-options="{
                                     'rtl':true,
                                    'items': 5,
                                    'nav': false,
                                    'loop': false,
                                    'dots': true,
                                    'margin': 20,
                                    'responsive': {
                                        '0': {
                                            'items': 1
                                        },
                                        '576': {
                                            'items': 2
                                        },
                                        '768': {
                                            'items': 2
                                        },
                                        '992': {
                                            'items': 2,
                                            'nav': true
                                        },
                                        '1200': {
                                            'items': 3,
                                            'dots': false,
                                            'nav': true
                                        }
                                    }
                                }">
                                {% for product in suggestion %}
                                    <div class="product product-border text-center">
                                        <figure class="product-media">
                                            <a href="{{ product.get_absolute_url }}">
                                                    <picture>
                                                        <source id="image-{{ product.id }}" srcset="{{ product.images.first.image.url }}" type="image/webp">
                                                        <img loading="lazy" decoding="async" src="{{ product.images.first.image.url }}"
                                                             alt="product"
                                                             width="260" height="293">
                                                    </picture>
                                            </a>
                                            <div class="product-action-vertical">
                                                <a href="#" class="btn-product-icon add-to-cart" data-toggle="modal" data-id="{{ product.id }}"
                                                   data-target="#addCartModal" title="اضافه به خرید">
                                                    <i class="fa-light fa-basket-shopping-simple"></i>
                                                </a>
                                                <a href="#" class="btn-product-icon btn-suggestion-wishlist" data-id="{{ product.id }}"
                                                   title="اضافه به علاقه مندی"><i class="fa-light fa-heart" id="like-icon-{{ product.id }}" {% if request.user in product.liked_by.all %}style="color: red;" {% endif %}></i>
                                                </a>
                                                <a href="#" class="btn-product-icon btn-suggestion-compare" data-id="{{ product.id }}" title="مقایسه">
                                                    <i class="fa-light fa-scale-balanced"></i>
                                                </a>
                                            </div>
                                        </figure>
                                        <div class="product-details rtl">
                                            <h3 class="product-name">
                                                <a href="{{ product.get_absolute_url }}" id="suggestion-title-{{ product.id }}">{{ product }}</a>
                                            </h3>
                                            <div class="product-price">
                                                <span class="price">  {{ product.get_price | commafy }} تومان  </span>
                                            </div>
                                            <div class="ratings-container">
                                                <div class="ratings-full">
                                                    <span class="ratings" style="width:{% widthratio product.site_score 1 10 %}%"></span>
                                                    <span class="tooltiptext tooltip-top"></span>
                                                </div>
                                                <a href="{{ product.get_absolute_url }}" class="rating-reviews">( {{ product.comments.count }} نظر )</a>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </section>
                    </div>
                    <aside class="col-xl-3 col-lg-4 sidebar right-sidebar sidebar-fixed sticky-sidebar-wrapper">
                        <div class="sidebar-overlay"></div>
                        <a class="sidebar-close" href="#"><i class="fa-light fa-xmark"></i></a>
                        <a href="#" class="sidebar-toggle"><i class="fa-light fa-chevron-right"></i></a>
                        <div class="sidebar-content">
                            <div class="sticky-sidebar">
                                <div class="widget widget-collapsible widget-vendor-info">
                                    <h3 class="widget-title"> اطلاعات فنی </h3>
                                    <ul class="widget-body filter-items">
                                        {% for feature in product.features.all %}
                                            <li class="store-name">
                                                <span>{{ feature.key }}  :</span><span class="details"> {{ feature.value }}</span>
                                            </li>
                                        {% endfor %}
                                    </ul>
                                </div>
                                <div class="widget widget-products">
                                    <h4 class="widget-title lh-1 border-no ">
                                        محصولات محبوب
                                    </h4>
                                    <div class="widget-body ">
                                        <div class="owl-carousel owl-nav-top" data-owl-options="{
                                     'rtl':true,
                                                'items': 1,
                                                'loop': true,
                                                'nav': true,
                                                'dots': false,
                                                'margin': 20
                                            }">
                                            <div class="products-col rtl">
                                                {% for product in most_viewed_col1 %}
                                                    <div class="product product-list-sm text-center">
                                                        <figure class="product-media">
                                                            <a href="{{ product.get_absolute_url }}">
                                                                <picture>
                                                                    <source srcset="{{ product.images.first.image.url }}"
                                                                            type="image/webp">
                                                                    <img loading="lazy" decoding="async"
                                                                         src="{{ product.images.first.image.url }}"
                                                                         alt="product" width="165" height="184">
                                                                </picture>
                                                            </a>
                                                        </figure>
                                                        <div class="product-details rtl">
                                                            <h3 class="product-name">
                                                                <a href="{{ product.get_absolute_url }}">{{ product }}</a>
                                                            </h3>
                                                            <div class="product-price">
                                                                <span class="price"> {{ product.get_price | commafy }} تومان </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                {% endfor %}
                                            </div><!-- End Products Col -->
                                            <div class="products-col rtl">
                                                {% for product in most_viewed_col2 %}
                                                    <div class="product product-list-sm text-center">
                                                        <figure class="product-media">
                                                            <a href="{{ product.get_absolute_url }}">
                                                                <picture>
                                                                    <source srcset="{{ product.images.first.image.url }}"
                                                                            type="image/webp">
                                                                    <img loading="lazy" decoding="async"
                                                                         src="{{ product.images.first.image.url }}"
                                                                         alt="product" width="165" height="184">
                                                                </picture>
                                                            </a>
                                                        </figure>
                                                        <div class="product-details rtl">
                                                            <h3 class="product-name">
                                                                <a href="{{ product.get_absolute_url }}">{{ product }}</a>
                                                            </h3>
                                                            <div class="product-price">
                                                                <span class="price"> {{ product.get_price | commafy }} تومان </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                {% endfor %}
                                            </div><!-- End Products Col -->
                                        </div>
                                    </div>
                                </div>
                                <!-- End Widget Products -->
                            </div>
                        </div>
                    </aside>
                </div>
            </div>
        </div>
    </main>
{% endblock %}

{% block script %}
    <script defer src="{% static 'js/product.js' %}"></script>
    <script defer>
        $(document).ready(function() {
            $('.product-countdown').each(function() {
                var $this = $(this);
                var untilStr = $this.data('until');
                if (!untilStr) return;

                var endTime = new Date(untilStr).getTime();

                function updateCountdown() {
                    var now = new Date().getTime();
                    var distance = endTime - now;

                    if (distance <= 0) {
                        $this.text("00:00:00");
                        clearInterval(interval);
                        location.reload();  // Reload page when countdown ends
                        return;
                    }

                    var days = Math.floor(distance / (1000 * 60 * 60 * 24));
                    var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                    var seconds = Math.floor((distance % (1000 * 60)) / 1000);

                    var formatted = "";
                    if (days > 0) {
                        formatted += days + "";
                    }
                    formatted +=
                        String(hours).padStart(2, '0') + ':' +
                        String(minutes).padStart(2, '0') + ':' +
                        String(seconds).padStart(2, '0');

                    $this.text(formatted);
                }

                updateCountdown();
                var interval = setInterval(updateCountdown, 1000);
            });
        });
    </script>
{% endblock %}
